<% if params[:id] && !worker_hosts.keys.include?(params[:id]) && params[:id] != 'all' %>
	<h1>Worker doesn't exist</h1>
<% elsif worker_hosts.size == 1 || params[:id] %>
	  <h1 class='wi'><%= @workers.size %> Workers</h1>
	  <p class='intro'>The workers listed below are all registered as active on your system.</p>
	  <table class='workers'>
	    <tr>
	      <th>&nbsp;</th>
	      <th>Where</th>
	      <th>Queues</th>
	      <th>Processing</th>
	    </tr>
	    <% for worker in @workers %>
	    <tr class="<%= worker.state %>">
	      <td class='icon'><img src="<%=u worker.state %>.png" alt="<%= worker.state %>" title="<%= worker.state %>"></td>

	      <% host, pid, queues = worker.to_s.split(':') %>
	      <td class='where'><a href="<%=u "workers/#{worker}"%>"><%= host %>:<%= pid %></a></td>
	      <td class='queues'><%= queues.split(',').map { |q| '<a class="queue-tag" href="' + u("/queues/#{q}") + '">' + q + '</a>'}.join('') %></td>

	      <td class='process'>
	        <% data = worker.processing || {} %>
	        <% if data['queue'] %>
	          <code><%= data['payload']['class'] %></code>
	          <small><a class="queue time" href="<%=u "/working/#{worker}" %>"><%= data['run_at'] %></a></small>
	        <% else %>
	          <span class='waiting'>Waiting for a job...</span>
	        <% end %>
	      </td>
	    </tr>
	    <% end %>
	    <% if @workers.empty? %>
	    <tr>
	      <td colspan='4' class='no-data'>There are no registered workers</td>
	    </tr>
	    <% end %>
	  </table>
	  <%= poll %>
	<% else %>
	  <h1 class='wi'>Workers</h1>
	  <p class='intro'>The hostnames below all have registered workers. Select a hostname to view its workers, or "all" to see all workers.</p>
	  <table class='queues'>
	    <tr>
	      <th>Hostname</th>
	      <th>Workers</th>
	    </tr>
	    <% for hostname, workers in worker_hosts.sort_by { |h,w| h } %>
	    <tr>
	      <td class='queue'><a class="queue" href="<%= url "workers/#{hostname}" %>"><%= hostname %></a></td>
	      <td class='size'><%= @workers.size %></td>
	    </tr>
	    <% end %>
	    <tr class="failed">
	      <td class='queue failed'><a class="queue" href="<%= url "workers/all" %>">all workers</a></td>
	      <td class='size'><%= Resque.workers.size %></td>
	    </tr>
	  </table>


<% end %>